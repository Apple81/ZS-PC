<!DOCTYPE html>
<html lang="en">

    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <meta charset="utf-8" />
        <title>用户注册管理 - 中山建设监理建筑工程文档协同管理系统</title>

        <meta name="description" content="overview &amp; stats" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

        <!-- bootstrap & fontawesome -->
        <link rel="stylesheet" href="<?php echo base_url()."assets/css/bootstrap.min.css"?>" />
        <link rel="stylesheet" href="<?php echo base_url()."assets/font-awesome/4.5.0/css/font-awesome.min.css"?>" />

        <!-- page specific plugin styles -->

        <!-- text fonts -->
        <link rel="stylesheet" href="<?php echo base_url()."assets/css/fonts.googleapis.com.css"?>" />

        <!-- ace styles -->
        <link rel="stylesheet" href="<?php echo base_url()."assets/css/ace.min.css"?>" class="ace-main-stylesheet" id="main-ace-style" />
        
        <!--self css-->
        <link rel="stylesheet" href="<?php echo base_url()."assets/css/self/self.css"?>" />

        <!--[if lte IE 9]>
            <link rel="stylesheet" href="<?php echo base_url()."assets/css/ace-part2.min.css"?>" class="ace-main-stylesheet" />
        <![endif]-->
        <link rel="stylesheet" href="<?php echo base_url()."assets/css/ace-skins.min.css"?>" />
        <link rel="stylesheet" href="<?php echo base_url()."assets/css/ace-rtl.min.css"?>" />

        <!--[if lte IE 9]>
          <link rel="stylesheet" href="<?php echo base_url()."assets/css/ace-ie.min.css"?>" />
        <![endif]-->

        <!-- inline styles related to this page -->

        <!-- ace settings handler -->
        <script src="<?php echo base_url()."assets/js/ace-extra.min.js"?>"></script>

        <!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

        <!--[if lte IE 8]>
        <script src="<?php echo base_url()."assets/js/html5shiv.min.js"?>"></script>
        <script src="<?php echo base_url()."assets/js/respond.min.js"?>"></script>
        <![endif]-->
    </head>

    <body class="no-skin">
        <!--Top Begin-->
        <?php $this->load->view("pageTop.html"); ?>
        <!--Top End-->

        <div class="main-container ace-save-state" id="main-container">
            <!--LeftTree Begin-->
            <?php $this->load->view("pageLeft.html"); ?>
            <!--LeftTree End-->

            <div class="main-content">
                <div class="widget-body">
                    <div class="widget-main padding-24">
                        <span style="font-size: 22px;">工作组</span>
                        <div class="hr hr8 hr-double hr-dotted"></div>
                        <div class="col-xs-5">
                        	<button class="btn btn-info" href="#modal-TypeAdd" role="button" data-toggle="modal">导入工作组</button>
                        	<button class="btn btn-info" href="#modal-WorkAdd" role="button" data-toggle="modal">新建工作组</button>
                        	<button class="btn btn-danger" role="button" onclick="delwg()">删除工作组</button>
                            <div class="widget-box">
                                <div class="widget-header widget-header-flat">
                                    <h4 class="widget-title smaller">
                                        <span>工作组列表</span>
                                    </h4>
                                    <input type="text" id="worgid" hidden="hidden">
                                </div>
                                <div class="widget-body">
                                    <div class="widget-main">
                                        <table id="dynamic-table" class="table table-striped table-bordered table-hover" style="width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>序号</th>
                                                    <th>工作组名称</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-7">
                        	<button class="btn btn-info"  href="#modal-WorktableAdd" role="button" data-toggle="modal">新建表</button>
                        	<button class="btn btn-danger" role="button" onclick="delwgmes()">删除表</button>
                            <div class="widget-box">
                                <div class="widget-header widget-header-flat">
                                    <h4 class="widget-title smaller">
                                        <span>工作组详情</span>
                                    </h4>
                                    <input type="text" id="mesid" hidden="hidden">
                                </div>
                                <div class="widget-body">
                                    <div class="widget-main">
                                        <table id="dynamic-table-list" class="table table-striped table-bordered table-hover" style="width:100%;">
                                            <thead>
                                                <tr>
                                                    <th>序号</th>
                                                    <th>表格名称</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            	<tr>
                                            		<th>01</th>
                                            		<th>表格</th>
                                            	</tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                             </div>
                         </div>
                    </div>
                </div>
                
            </div>
            <!-- main-content -->
			
            <!--Foor Begin-->
            <?php $this->load->view("pageFoot.html"); ?>
            <!--Foot End-->
            <!--model begin-->
            <?php $this->load->view("model_workg.html"); ?>
            <!--model end-->
        </div>
        <!-- /.main-container -->

        <!-- basic scripts -->

        <!--[if !IE]> -->
        <script src="<?php echo base_url()."assets/js/jquery-2.1.4.min.js"?>"></script>

        <!-- <![endif]-->

        <!--[if IE]>
        <script src="<?php echo base_url()."assets/js/jquery-1.11.3.min.js"?>"></script>
        <![endif]-->
        <script src="<?php echo base_url()."assets/js/bootstrap.min.js"?>"></script>

        <!-- page specific plugin scripts -->

        <!--[if lte IE 8]>
          <script src="<?php echo base_url()."assets/js/excanvas.min.js"?>"></script>
        <![endif]-->
        <script src="<?php echo base_url()."assets/js/jquery-ui.custom.min.js"?>"></script>
        <script src="<?php echo base_url()."assets/js/jquery.ui.touch-punch.min.js"?>"></script>
        <script src="<?php echo base_url()."assets/js/jquery.easypiechart.min.js"?>"></script>
        <script src="<?php echo base_url()."assets/js/jquery.sparkline.index.min.js"?>"></script>
        <script src="<?php echo base_url()."assets/js/jquery.flot.min.js"?>"></script>
        <script src="<?php echo base_url()."assets/js/jquery.flot.pie.min.js"?>"></script>
        <script src="<?php echo base_url()."assets/js/jquery.flot.resize.min.js"?>"></script>
        <script src="<?php echo base_url()."assets/js/jquery-ui.min.js"?>"></script>
        <script src="<?php echo base_url()."assets/js/jquery.ui.touch-punch.min.js"?>"></script>
        
        <!--dataTable-->
        <script src="<?php echo base_url()."assets/js/jquery.dataTables.min.js"?>"></script>
        <script src="<?php echo base_url()."assets/js/jquery.dataTables.bootstrap.min.js"?>"></script>
        <script src="<?php echo base_url()."assets/js/dataTables.buttons.min.js"?>"></script>
        <script src="<?php echo base_url()."assets/js/buttons.flash.min.js"?>"></script>
        <script src="<?php echo base_url()."assets/js/buttons.html5.min.js"?>"></script>
        <script src="<?php echo base_url()."assets/js/buttons.print.min.js"?>"></script>
        <script src="<?php echo base_url()."assets/js/buttons.colVis.min.js"?>"></script>
        <script src="<?php echo base_url()."assets/js/dataTables.select.min.js"?>"></script>
        
        <!-- ace scripts -->
        <script src="<?php echo base_url()."assets/js/ace-elements.min.js"?>"></script>
        <script src="<?php echo base_url()."assets/js/ace.min.js"?>"></script>

        <!-- inline scripts related to this page -->
        <script src="<?php echo base_url()."assets/js/self/Show_LeftTreeA.js"?>"></script>
        
        <script type="text/javascript">
            var table;
            jQuery(function($) {
                /*
                 * TableINI
                 */
                var showMes = "<?php echo site_url('System/WorkGroup_Show'); ?>";
                table = $('#dynamic-table').DataTable({
                    ajax:showMes,
                    columns:[
                        {"data":'rowNum'},
                        {"data":'workgname'},
                    ],
                    oLanguage: {
                        sLengthMenu: "显示 _MENU_ 条数据",
                    },
                    "processing": true,
                    "aaSorting": [],
                    "aoColumnDefs": [{
                        'bSortable': false,
                        'aTargets': [],
                    }],
                });
                //table Click
                var WorkGId='0';
                var showform = "<?php echo site_url('System/WorkGroup_Mes');?>"+'/'+WorkGId;
                tabMesList = $('#dynamic-table-list').DataTable({
                    ajax:showform,
                    columns:[
                        {"data":'rowNum'},
                        {"data":'tablename'},
                    ],
                      oLanguage: {
                        sLengthMenu: "显示 _MENU_ 条数据",
                    },
                    "processing": true,
                    "aaSorting": [],
                    "aoColumnDefs": [{
                        'bSortable': false,
                        'aTargets': []
                    }],
                });
                //ACTION
                $('#dynamic-table tbody').on('click', 'tr', function () {
                    if ($(this).hasClass('selected')) {
                        $(this).removeClass('selected');
                    }
                    else {
                        table.$('tr.selected').removeClass('selected');
                        $(this).addClass('selected');
                    }
                    try{
                        //显示产品类型信息
                        var WorkGId = table.row('.selected').data().id;
                        $('#wgid').val(WorkGId)
                        $('#worgid').val(WorkGId)
                        var showform = "<?php echo site_url('System/WorkGroup_Mes');?>"+'/'+WorkGId;
                        //刷新产品列表
                        tabMesList.ajax.url(showform).load();
                    }catch(e){
                        
                    }
                })
                $('#dynamic-table-list tbody').on('click', 'tr', function () {
                    if($(this).hasClass('selected')){
                        $(this).removeClass('selected');
                    }
                    else {
                        tabMesList.$('tr.selected').removeClass('selected');
                        $(this).addClass('selected');
                    }
                    try{
                        var MesId = tabMesList.row('.selected').data().id;
                        $('#mesid').val(MesId)
                        //selectINI
                    }catch(e){ }
                })
           })
            //工作组自定义功能
            var i=1;
            //动态添加行
            $('#addrows').on('click',function(){
//          	alert('添加')
            	i=i+1;
            	var EleText = "<div class='form-group has-info  page-header'>";
            	EleText+="<label class='col-sm-3 control-label no-padding-right'>工作组<span>"+i+"</span>：</label>";
            	EleText+="<div class='col-sm-5'>";
            	EleText+="<span class='block input-icon input-icon-right'>";
            	EleText+="<input class='NewDocMes' type='text' name='TypeName'>";
            	EleText+="</span>";
            	EleText+="</div>";
            	EleText+="<div class='help-block col-xs-12 col-sm-reset inline'></div>";
            	EleText+="</div>";
			    $('#workg').append(EleText);
            }); 
            $('#deleterows').on('click',function(){
            	i=i-1;
            	$("#workg").children().last().remove();
            })
            //保存工作组
            $('#wgsave').on('click',function(){
            	var wgname=new Array();
				var returna_date = $("input[name$='TypeName']");//匹配所有name结尾为returna_date的数组
			    for(var x=0; x<returna_date.length;x++){
			        wgname[x]=$(returna_date[x]).val();
			    }
			    var wgname = wgname.toString();
			    var wgurl="<?php echo site_url('System/Newworkg');?>";
			    $.ajax({
			    	type:"post",
			    	url:wgurl,
			    	async:true,
			    	dataType:'json',
					data:{wgname:wgname}, 
			    	success:function(data){
			    		if(data['status']=="success"){
			    			alert('新建成功')
			    		}
			    		else if(data['mess']=='1'){
			    			alert('工作组名重复')
			    		}
			    		else{
			    			alert('新建失败')
			    		}
			    		$('#modal-WorkAdd').modal('hide');
            			table.ajax.reload();
			    	},
			    	error:function(s,e,t){
			    		alert('失败，请联系管理员')
			    		$('#modal-WorkAdd').modal('hide');
			    	}
			    });
			    
   			})
            //表格自定义操作
            $('#addtable').on('click',function(){
            	i=i+1;
            	var EleText = "<div class='form-group has-info  page-header'>";
            	EleText+="<label class='col-sm-3 control-label no-padding-right'>表格名<span>"+i+"</span>：</label>";
            	EleText+="<div class='col-sm-5'>";
            	EleText+="<span class='block input-icon input-icon-right'>";
            	EleText+="<input class='NewDocMes' type='text' name='TableName'>";
            	EleText+="</span>";
            	EleText+="</div>";
            	EleText+="<div class='help-block col-xs-12 col-sm-reset inline'></div>";
            	EleText+="</div>";
			    $('#worktable').append(EleText);
            }); 
            $('#deletetable').on('click',function(){
            	i=i-1;
            	$("#worktable").children().last().remove();
            })
            //保存表单名
            $('#tablesave').on('click',function(){
                if($('#wgid').val()==""){
                    alert('请选择工作组');
                }
                else{
            	var tablename=new Array();
				var returna_date = $("input[name$='TableName']");//匹配所有name结尾为returna_date的数组
			    for(var x=0; x<returna_date.length;x++){
			        tablename[x]=$(returna_date[x]).val();
			    }
			    var tablename = tablename.toString();
			    var tableurl="<?php echo site_url('System/NewTablewg');?>";
			    $.ajax({
			    	type:"post",
			    	url:tableurl,
			    	async:true,
			    	dataType:'json',
					data:{
						tablename:tablename,
						wgid:$('#wgid').val()
					},
			    	success:function(data){
			    		if(data['status']=="success"){
			    			alert('新建成功')
			    		}
			    		else if(data['mess']=='1'){
			    			alert('错误提示：'+data['exist']+'已存在，其他表单新建成功')
			    		}
			    		else{
			    			alert('新建失败')
			    		}
			    		$('#modal-WorktableAdd').modal('hide');
			   			window.location.reload();
			    	},
			    	error:function(s,e,t){
			    		alert('失败，请联系管理员')
			    	}
			    });
			   } 
   			})
            function delwg(){
            	var workgid=$('#worgid').val();
            	if(workgid==""){
            		alert("请选择工作组进行操作")
            	}
            	else{
            		console.log(workgid);
            		var delwg="<?php echo site_url('System/delwg');?>"+'/'+workgid;
	            	$.ajax({
	            		type:"post",
	            		url:delwg,
	            		async:true,
	            		dataType:'json',
	            		success:function(data){
	            			if(data['status']=='success'){
	            				alert("删除成功")
	            			}
	            		    else{
	            		    	alert("删除失败")
	            		    }
	            		    window.location.reload();
	            		},
	            		error:function(s,e,t){
	            			alert("出现错误，删除失败")
	            		}
	            	});
            	}
            }
            function delwgmes(){
            	var mesid=$('#mesid').val();
            	if(mesid==""){
            		alert("请选择模板表操作")
            	}
            	else{
            		var delwgmes="<?php echo site_url('System/delwgmes');?>"+'/'+mesid;
	            	$.ajax({
	            		type:"post",
	            		url:delwgmes,
	            		async:true,
	            		dataType:'json',
	            		success:function(data){
	            			if(data['status']=='success'){
	            				alert("删除成功")
	            			}
	            		    else{
	            		    	alert("删除失败")
	            		    }
	            		    window.location.reload();
	            		},
	            		error:function(s,e,t){
	            			alert("出现错误，删除失败")
	            		}
	            	});
            	}
            	
            }
            
        </script>
   </body>
</html>